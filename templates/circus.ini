[circus]
endpoint = ${options['endpoint']}
pubsub_endpoint = ${options['pubsub_endpoint']}
check_delay = 5
statsd = True
debug = 0
httpd = True
httpd_host = 0.0.0.0
httpd_port = 8080
logoutput = ${parts.buildout.directory}/var/log/circus.log


{% if options['master'] %}
[watcher:master]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --master -P ${parts.ports['0']} --master-bind-host ${options['master-bind-host']}  --master-bind-port ${parts.ports['1000']} -f ${parts.buildout.directory}/scripts/load.py
numprocesses = 1
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.master.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.master.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:master_api]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --master -P ${parts.ports['2']} --master-bind-host ${options['master-bind-host']}  --master-bind-port ${parts.ports['1002']} -f ${parts.buildout.directory}/scripts/api.py
numprocesses = 1
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.master_api.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.master_api.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:master_write_api]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --master -P ${parts.ports['4']} --master-bind-host ${options['master-bind-host']}  --master-bind-port ${parts.ports['1004']} -f ${parts.buildout.directory}/scripts/write_api.py
numprocesses = 1
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.master_write_api.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.master_write_api.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:master_auctions]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --master -P ${parts.ports['6']} --master-bind-host ${options['master-bind-host']}  --master-bind-port ${parts.ports['1006']} -f ${parts.buildout.directory}/scripts/auctions.py
numprocesses = 1
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.master_auctions.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.master_auctions.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:master_auction_authorized]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --master -P ${parts.ports['8']} --master-bind-host ${options['master-bind-host']}  --master-bind-port ${parts.ports['1008']} -f ${parts.buildout.directory}/scripts/auction_authorized.py
numprocesses = 1
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.master_auction_authorized.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.master_auction_authorized.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2
{% end %}
{% if options['slave'] %}
[watcher:slave]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --slave --master-host ${options['master-host']} --master-port ${parts.ports['1000']} -f ${parts.buildout.directory}/scripts/${options['locustfile']} ${options['class']}
warmup_delay = 0
numprocesses = ${options['slaves_count']}
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.slave.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.slave.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:slave_api]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --slave --master-host ${options['master-host']} --master-port ${parts.ports['1002']} -f ${parts.buildout.directory}/scripts/api.py Api
warmup_delay = 0
numprocesses = ${options['slaves_count']}
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_api.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_api.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:slave_write_api]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --slave --master-host ${options['master-host']} --master-port ${parts.ports['1004']} -f ${parts.buildout.directory}/scripts/write_api.py Api
warmup_delay = 0
numprocesses = ${options['slaves_count']}
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_write_api.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_write_api.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:slave_auction]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --slave --master-host ${options['master-host']} --master-port ${parts.ports['1006']} -f ${parts.buildout.directory}/scripts/auctions.py AuctionAnonymous
warmup_delay = 0
numprocesses = ${options['slaves_count']}
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_auction.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_auction.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2

[watcher:slave_auction_authorized]
cmd = ${parts.buildout.directory}/bin/locust --no-reset-stats --slave --master-host ${options['master-host']} --master-port ${parts.ports['1008']} -f ${parts.buildout.directory}/scripts/auction_authorized.py AuctionAuthorized
warmup_delay = 0
numprocesses = ${options['slaves_count']}
copy_env = 1
working_dir = ${parts.buildout.directory}
stdout_stream.class = FileStream
stderr_stream.class = FileStream
stdout_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_auction_authorized.stdout.log
stderr_stream.filename = ${parts.buildout.directory}/var/log/locust.slave_auction_authorized.stderr.log
stdout_stream.max_bytes = 1048576
stderr_stream.max_bytes = 1048576
stdout_stream.backup_count = 2
stderr_stream.backup_count = 2
{% end %}
